<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Supplier Search</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
  </head>
  <body>
    <header>
      <h1>Supplier Search</h1>
    </header>
    <label>Enter keywords to search:</label>
    <input type="text" id="input_field" name="input_field" required />
    <button type="submit" id="submit_input" onclick="send_input()">
      Search
    </button>

    <!-- Container to display the results -->
    <div id="results"></div>

    <script>
      function isValidURL(str) {
        var pattern = new RegExp(
          "^(https?:\\/\\/)?" + // protocol
            "((([a-zA-Z0-9$_.+!*',;?&=-]|%[0-9a-fA-F]{2})+(:([a-zA-Z0-9$_.+!*',;?&=-]|%[0-9a-fA-F]{2})+)?@)?" + // user:pass
            "((([a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9])|([a-zA-Z0-9]))\\.)+([a-zA-Z]{2,6})|" + // domain name
            "((\\d{1,3}\\.){3}\\d{1,3}))" + // OR ip (v4) address
            "(\\:\\d+)?(\\/[-a-zA-Z0-9%_.~+]*)*" + // port and path
            "(\\?[;&a-zA-Z0-9%_.~+=-]*)?" + // query string
            "(\\#[-a-zA-Z0-9_]*)?$",
          "i"
        ); // fragment locator
        return !!pattern.test(str);
      }

      function send_input() {
        fetch("/request_search", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            value: document.getElementById("input_field").value,
          }),
        })
          .then((response) => response.json())
          .then((response) => displayResults(response));
      }

      function displayResults(data) {
        const resultsContainer = document.getElementById("results");
        resultsContainer.innerHTML = ""; // Clear previous results

        // Create table
        const table = document.createElement("table");

        // Create table headers
        const headerRow = document.createElement("tr");
        Object.keys(data[0]).forEach((key) => {
          const th = document.createElement("th");
          th.innerText = key;
          headerRow.appendChild(th);
        });
        table.appendChild(headerRow);

        // Create table rows
        Object.values(data).forEach((item) => {
          const row = document.createElement("tr");
          Object.values(item).forEach((value) => {
            const td = document.createElement("td");
            td.innerText = value;
            row.appendChild(td);
          });
          table.appendChild(row);
        });

        resultsContainer.appendChild(table);
      }
    </script>
  </body>
</html>
